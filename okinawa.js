!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.okinawa=t():e.okinawa=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Background:()=>Lt,Clock:()=>ae,Core:()=>k,Device:()=>x,Effects:()=>U,Emitter:()=>Tt,Fonts:()=>te,GUI:()=>i,INPUT:()=>n,Item:()=>C,Localization:()=>ue,Logs:()=>ht,MATH:()=>r,Options:()=>a,Particles:()=>W,Player:()=>st,Preloader:()=>it,Scene:()=>We,Sounds:()=>J,Sprites:()=>Q,engine:()=>ct,init:()=>Nt});var n={};e.r(n),e.d(n,{COMBO_TYPES:()=>A,Controller:()=>b,KEYS:()=>g,Receiver:()=>v});var i={};e.r(i),e.d(i,{ALIGN:()=>Ne,EVENTS:()=>Le,GuiConsole:()=>Ie,GuiElement:()=>be,GuiText:()=>xe,ORDENATION:()=>Fe});var r={};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===o(r)?r:String(r)),i)}var r}e.r(r),e.d(r,{Point:()=>u,Rotation:()=>_,angleToDirectionVector:()=>pt,pointDistance:()=>yt});var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.useAnimationFrame=!1,this.useSmoothParticles=!1,this.drawBoundingBoxes=!1,this.drawMaxRadius=!1,this.drawCollisionRadius=!1,this.drawOrigins=!1,this.drawCenters=!1,this.drawTrackers=!1,this.drawDirectionVectors=!1,this.showFps=!1,this.showStatistics=!1,this.showResizeMessage=!0,this.outputPressedKeys=!1,this.outputPressedCombos=!1,this.outputClicks=!1,this.debugInConsole=!1,this.debugInHtml=!1,this.debugFunctionNames=!1,this.allowPause=!0,this.allowHalt=!1,this.allowFForFps=!0,this.pauseOnWindowChange=!1,this.avoidLeavingPage=!1,this.preventDefaultKeyStrokes=!0,this.useLanguageScreen=!1,this.defaultLanguage="english",this.assetsURLPrefix=null}var t,n;return t=e,(n=[{key:"addOptions",value:function(e){for(var t in e)this[t]=e[t]}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===l(r)?r:String(r)),i)}var r}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=void 0===t?0:t,this.y=void 0===n?0:n}var t,n;return t=e,(n=[{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){var t=this.magnitude();return new e(this.x/t,this.y/t)}},{key:"equals",value:function(t){return t instanceof e!=0&&this.x==t.x&&this.y==t.y}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function f(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function h(){var e="";return window.location.href?window.location.href:("file:"!=window.location.protocol&&(e+=window.location.protocol+"//"),""!==window.location.host&&(e+=window.location.host+"/"),e)}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==y(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==y(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===y(r)?r:String(r)),i)}var r}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inverseKeyboard={},this.pressed={},this.lastPressed=[],this.lastPressedTime=(new Date).getTime(),this.currentInputController=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){for(var e in g)Object.prototype.hasOwnProperty.call(g,e)&&(this.inverseKeyboard[g[e]]=e);f("keyup",document,(function(e){ct.input.onKeyup(e)})),f("keydown",document,(function(e){ct.input.onKeydown(e),ct.input.isTargetInput(e)||!0!==ct.options.preventDefaultKeyStrokes&&8!=e.keyCode&&46!=e.keyCode||e.preventDefault()})),f("blur",window,(function(){ct.input.resetKeys(),ct.options.pauseOnWindowChange&&ct.pauseGame()})),f("touchstart",ct.core.canvas,(function(e){return ct.input.onClickStart(e.touches[0].clientX,e.touches[0].clientY),navigator.userAgent.match(/Android/i)&&e.preventDefault(),!1})),f("touchmove",ct.core.canvas,(function(e){return e.preventDefault(),!1})),f("touchend",ct.core.canvas,(function(e){return e.preventDefault(),!1})),f("click",ct.core.canvas,(function(e){return ct.input.onClickStart(e.clientX,e.clientY),e.preventDefault(),!1})),f("mousedown",ct.core.canvas,(function(e){return e.preventDefault(),!1}))}},{key:"activate",value:function(){}},{key:"getCurrentInputcontroller",value:function(){return this.currentInputController}},{key:"setCurrentInputController",value:function(e){this.currentInputController=e}},{key:"isKeyPressed",value:function(e){return this.pressed[e]}},{key:"onKeydown",value:function(e){!0!==this.pressed[e.keyCode]&&(this.pressed[e.keyCode]=!0,this.addLastPressed(e.keyCode))}},{key:"onKeyup",value:function(e){delete this.pressed[e.keyCode]}},{key:"onClickStart",value:function(e,t){if(!0!==ct.device.isResizing){var n=new u(e,t),i=ct.device.getGlobalScroll();n.x+=i.x,n.y+=i.y,n.x<ct.device.canvasGlobalOffset.x||n.y<ct.device.canvasGlobalOffset.y||n.x>ct.device.canvasGlobalOffset.x+ct.core.canvas.width||n.y>ct.device.canvasGlobalOffset.y+ct.core.canvas.height||(n.x-=ct.device.canvasGlobalOffset.x,n.y-=ct.device.canvasGlobalOffset.y,this.currentInputController.detectClick(n))}}},{key:"resetKeys",value:function(){for(var e in this.pressed)this.pressed[e]=!1}},{key:"addLastPressed",value:function(e){this.currentInputController.informKeyPressed(e);var t=(new Date).getTime();t-this.lastPressedTime>1e3&&(this.lastPressed=[]),this.lastPressedTime=t,this.lastPressed.push(e),this.lastPressed.length>10&&this.lastPressed.shift(),!0===ct.options.outputPressedKeys&&ct.logs.log("Input.addLastPressed","Pressed key: "+this.inverseKeyboard[e],t);var n=this.currentInputController.detectCombo();null!==n&&this.currentInputController.informComboPerformed(n,t)}},{key:"addClick",value:function(e){this.currentInputController.informClick(e),!0===ct.options.outputClicks&&ct.logs.log("Input.addClick","Click over: "+e)}},{key:"getKeyFromCode",value:function(e){return this.inverseKeyboard[e]}},{key:"convertKeyToNumber",value:function(e){switch(e){case g.NINE:return 9;case g.EIGTH:return 8;case g.SEVEN:return 7;case g.SIX:return 6;case g.FIVE:return 5;case g.FOUR:return 4;case g.THREE:return 3;case g.TWO:return 2;case g.ONE:return 1;case g.ZERO:return 0}return-1}},{key:"convertNumberToKey",value:function(e){switch(e){case 9:return g.NINE;case 8:return g.EIGTH;case 7:return g.SEVEN;case 6:return g.SIX;case 5:return g.FIVE;case 4:return g.FOUR;case 3:return g.THREE;case 2:return g.TWO;case 1:return g.ONE;case 0:return g.ZERO}return g.ZERO}},{key:"isTargetInput",value:function(e){return"textarea"==e.target.type||"text"==e.target.type||"number"==e.target.type||"email"==e.target.type||"password"==e.target.type||"search"==e.target.type||"tel"==e.target.type||"url"==e.target.type||e.target.isContentEditable}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===d(r)?r:String(r)),i)}var r}var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.combos={},this.comboListeners={},this.keyListeners={},this.clickableZones={},this.clickListeners=[]}var t,n;return t=e,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){ct.input.setCurrentInputController(this),this.addKeyListener(ct.core,"eventKeyPressed",[g.P,g.ESC,g.F],!0)}},{key:"addKeyListener",value:function(e,t,n,i){void 0===i&&(i=!1);var r={};r.listeningOb=e,r.listeningFunc=t,r.onPause=i;for(var o=0,s=n.length;o<s;o++)void 0===this.keyListeners[n[o]]?this.keyListeners[n[o]]=[r]:this.keyListeners[n[o]].push(r)}},{key:"addClickListener",value:function(e,t,n){void 0===n&&(n=!1);var i={};i.listeningOb=e,i.listeningFunc=t,i.onPause=n,this.clickListeners.push(i)}},{key:"removeListeners",value:function(e){var t,n,i,r;for(t in this.keyListeners)for(n=0,r=this.keyListeners[t].length;n<r;n++)this.keyListeners[t][n].listeningOb==e&&(this.keyListeners[t].splice(n,1),this.keyListeners[t].length||delete this.keyListeners[t]);for(t=0,i=this.clickListeners.length;t<i;t++)for(n=0,r=this.clickListeners[t].length;n<r;n++)this.clickListeners[t][n].listeningOb==e&&this.clickListeners[t].splice(n,1)}},{key:"informKeyPressed",value:function(e){var t=[];if(void 0!==this.keyListeners[e]&&(t=t.concat(this.keyListeners[e])),void 0!==this.keyListeners[g.ANY_KEY]&&(t=t.concat(this.keyListeners[g.ANY_KEY])),void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n];!r.onPause&&ct.paused||void 0!==r.listeningOb[r.listeningFunc]&&r.listeningOb[r.listeningFunc](e)}}},{key:"informClick",value:function(e){if(void 0!==this.clickListeners)for(var t=0,n=this.clickListeners.length;t<n;t++){var i=this.clickListeners[t];!i.onPause&&ct.paused||void 0!==i.listeningOb[i.listeningFunc]&&i.listeningOb[i.listeningFunc](e)}}},{key:"defineCombo",value:function(e,t,n){this.combos[e]={comboType:t,comboKeys:n,lastTime:0}}},{key:"addComboListener",value:function(e,t,n,i){void 0===i&&(i=!1);var r=[];r.listeningOb=e,r.listeningFunc=t,r.onPause=i;for(var o=0,s=n.length;o<s;o++)void 0===this.comboListeners[n[o]]?this.comboListeners[n[o]]=[r]:this.comboListeners[n[o]].push(r)}},{key:"informComboPerformed",value:function(e,t){!0===ct.options.outputPressedCombos&&ct.logs.log("Input.informComboPerformed","Combo activated: "+e,t),this.combos[e].lastTime=t;var n=this.comboListeners[e];if(void 0!==n)for(var i=0,r=n.length;i<r;i++){var o=n[i];!o.onPause&&ct.paused||void 0!==o.listeningOb[o.listeningFunc]&&o.listeningOb[o.listeningFunc](e)}}},{key:"detectCombo",value:function(){for(var e in this.combos){var t=this.combos[e],n=void 0,i=void 0;if(t.comboType==A.SIMULTANEOUS){for(n=0,i=t.comboKeys.length;n<i&&ct.input.isKeyPressed(t.comboKeys[n]);n++)if(n==i-1&&ct.input.isKeyPressed(t.comboKeys[n]))return e}else if(t.comboType==A.CONSECUTIVE){var r=ct.input.lastPressed.length,o=t.comboKeys.length;if(r<o)return null;for(n=1;n<=o&&n<=r&&t.comboKeys[o-n]==ct.input.lastPressed[r-n];n++)if(n>=o||n>=r)return e}}return null}},{key:"addClickZone",value:function(e,t,n,i){this.clickableZones[e]={position:t,size:n,character:i}}},{key:"detectClick",value:function(e){for(var t in this.clickableZones){var n=this.clickableZones[t];e.x>=n.position.x-n.size.x/2&&e.x<=n.position.x+n.size.x/2&&e.y>=n.position.y-n.size.y/2&&e.y<=n.position.y+n.size.y/2&&(null!==n.character&&ct.input.addLastPressed(n.character),ct.input.addClick(t))}}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),g={ANY_KEY:-1,INSERT:45,DELETE:46,SPACEBAR:32,ESC:27,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222,NTILDE:209},A={CONSECUTIVE:1,SIMULTANEOUS:2};function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==w(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===w(r)?r:String(r)),i)}var r}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.FRAMES_PER_SECOND=60,this.TIME_PER_FRAME=1e3/this.FRAMES_PER_SECOND,this.paused=!1,this.halted=!1,this.canvas=null,this.ctx=null,this.size=new u(500,500),this.useAnimationFrame=!1,this.timeLastRender=(new Date).getTime(),this.timeGameStart=(new Date).getTime(),this.fpsPassed=0,this.fps=this.FRAMES_PER_SECOND}var t,n;return t=e,(n=[{key:"initialize",value:function(e){return ct.logs.log("Engine::Core.initialize","Initializing engine core object"),this.canvas=document.getElementById(e),this.size.x=this.canvas.width,this.size.y=this.canvas.height,this.timeLastRender=(new Date).getMilliseconds(),this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),this.ctx?(ct.logs.log("Engine::Core.initialize","UserAgent: "+ct.device.getUserAgent()),!1===ct.options.useAnimationFrame||null===window.requestAnimationFrame?(this.useAnimationFrame=!1,ct.logs.log("Engine::Core.initialize","NOT using requestAnimationFrame")):(this.useAnimationFrame=!0,ct.logs.log("Engine::Core.initialize","Modern browser, using requestAnimationFrame")),this.loop(),1):(ct.logs.log("Engine::Core.initialize","Old browser, unable to create canvas context"),alert("Unable to get canvas context. Old browser?"),null)}},{key:"activate",value:function(){ct.logs.log("Engine::activate","Starting engine"),ct.game.activate(),ct.scenes.advanceScene()}},{key:"eventKeyPressed",value:function(e){e==g.P&&!0===ct.options.allowPause?this.paused?this.unpauseGame():!1!==ct.scenes.getCurrentScene().playable&&this.pauseGame():e==g.ESC&&!0===ct.options.allowHalt?this.halted?(this.halted=!1,ct.logs.log("Engine::eventKeyPressed","Engine un-halted"),this.timeLastRender=(new Date).getTime(),this.loop()):(this.halted=!0,ct.logs.log("Engine::eventKeyPressed","Engine halted"),ct.scenes.getCurrentScene().gui.get("console").addText("halt","Engine halted"),ct.scenes.getCurrentScene().gui.draw(this.ctx)):e!=g.F||!0!==ct.options.allowFForFps||this.paused||this.halted||(!0===ct.options.showFps?ct.options.showFps=!1:ct.options.showFps=!0)}},{key:"loop",value:function(){var e=(new Date).getTime(),t=e-this.timeLastRender;if(t>=ct.core.TIME_PER_FRAME){this.timeLastRender=e;var n=ct.scenes.getCurrentScene();if(this.halted)return;n&&!0===n.isCurrent&&(!1===this.paused&&(n.step(t),void 0!==ct.game&&ct.game.step(t),ct.effects.step(t),ct.particles.step(t)),ct.clock.step(t),ct.player.step(t),n.draw(this.ctx),ct.effects.draw(this.ctx),ct.particles.draw(this.ctx),this.fpsPassed++,!0===ct.options.showStatistics&&(n.getAttachedItems().length>0&&n.gui.get("console").addText("numItems",n.getAttachedItems().length+" "+ct.localization.get("items")),ct.effects.effects.length>0&&n.gui.get("console").addText("numEffects",ct.effects.effects.length+" "+ct.localization.get("effects")),ct.particles.particles.length>0&&n.gui.get("console").addText("numParticles",ct.particles.particles.length+" "+ct.localization.get("particles")))),t=0}!0===this.useAnimationFrame?window.requestAnimationFrame((function(){ct.core.loop()})):setTimeout((function(){ct.core.loop()}),ct.core.TIME_PER_FRAME-t)}},{key:"clearScreen",value:function(){this.ctx.clearRect(0,0,this.size.x,this.size.y)}},{key:"pauseGame",value:function(){!1!==ct.options.allowPause&&(this.paused=!0,ct.scenes.getCurrentScene().pauseGame())}},{key:"unpauseGame",value:function(){!1!==ct.options.allowPause&&(this.paused=!1,ct.scenes.getCurrentScene().unpauseGame())}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==P(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==P(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===P(r)?r:String(r)),i)}var r}var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasGlobalOffset=new u,this.isTouchDevice=!1,this.isResizing=!1,this._clearTimeOutId=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){var e=this;this.isTouchDevice=this.detectTouchDevice(),this.isTouchDevice?ct.logs.log("Engine::Initialize","Touch device detected"):ct.logs.log("Engine::Initialize","Touch device NOT detected"),this.canvasGlobalOffset=ct.device.getGlobalOffset(ct.core.canvas),f("resize",window,(function(){ct.device.isResizing=!0,!0===ct.options.showResizeMessage&&ct.gui.get("console").addText("resize","Resizing!"),ct.device.canvasGlobalOffset=ct.device.getGlobalOffset(ct.core.canvas),clearTimeout(e._clearTimeOutId),e._clearTimeOutId=setTimeout(ct.device.doneResizing,1e3)})),!0===ct.options.avoidLeavingPage&&this.avoidLeavingPage()}},{key:"doneResizing",value:function(){ct.device.isResizing=!1,!0===ct.options.showResizeMessage&&ct.gui.get("console").addText("resize","Resizing done")}},{key:"activate",value:function(){}},{key:"getGlobalScroll",value:function(){var e=new u(0,0);if(window.pageYOffset)e.x=window.pageXOffset,e.y=window.pageYOffset;else{var t=document.getElementsByTagName("html")[0];t.scrollTop&&(e.x=t.scrollLeft,e.y=t.scrollTop)}return e}},{key:"getGlobalOffset",value:function(e){var t=new u(0,0);for(t.x=e.offsetLeft,t.y=e.offsetTop;e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}},{key:"detectTouchDevice",value:function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"avoidLeavingPage",value:function(){window.onbeforeunload=function(){return""}}},{key:"createAndDownloadFile",value:function(e,t){if(window.navigator.msSaveOrOpenBlob){var n=new Blob([t],{type:"text/csv;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(n,e)}else{var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},{key:"detectIE",value:function(){var e=navigator.userAgent.toLowerCase();return/msie/.test(e)?parseFloat((e.match(/.*(?:rv|ie)[/: ](.+?)([ );]|$)/)||[])[1]):navigator.appVersion.indexOf("Trident/")>0?11:-1}},{key:"isIE",value:function(){return-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0}}])&&O(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==E(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==E(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===E(r)?r:String(r)),i)}var r}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.angle=0,this.a=1,this.b=0,this.c=0,this.d=1}var t,n;return t=e,(n=[{key:"getAngle",value:function(){return this.angle}},{key:"rotate",value:function(e){this.update(this.angle+e)}},{key:"update",value:function(e){this.angle=e,this.a=Math.cos(this.angle),this.b=-Math.sin(this.angle),this.c=Math.sin(this.angle),this.d=Math.cos(this.angle)}},{key:"transformPosition",value:function(e){return new u(e.x*this.a+e.y*this.b,e.x*this.c+e.y*this.d)}}])&&T(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==R(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==R(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===R(r)?r:String(r)),i)}var r}var C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteName=null,this._visible=!0,this.position=new u,this.size=new u,this.scaling=new u(1,1),this.speed=new u,this.maxVel=0,this.accel=0,this.vRot=0,this.maxVRot=0,this.accelRot=0,this.rotation=new _,this.globalAlpha=1,this.maxRadius=0,this.collisionRadius=0,this.isAnimated=!1,this.currentFrame=0,this.numLoops=1,this.forceFrameSpeed=0,this.timeLastFrame=0,this._attachedItems=[],this._removedItems=[],this._parent=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++)this._attachedItems[e].activate()}},{key:"getVisible",value:function(){return this._visible}},{key:"setVisible",value:function(e){this._visible=e}},{key:"getParent",value:function(){return this._parent}},{key:"setParent",value:function(e){this._parent=e}},{key:"getParentScene",value:function(){for(var e=this;null!==e.getParent();)e=e.getParent();return e===this?ct.scenes.getCurrentScene():e}},{key:"getAttachedItems",value:function(){return this._attachedItems}},{key:"attachItem",value:function(e){this._attachedItems.push(e),e.setParent(this)}},{key:"detachItem",value:function(e){var t=this.getParentScene();t.input.removeListeners(e);for(var n=e.children(),i=0,r=n.length;i<r;i++)t.input.removeListeners(n[i]);this._removedItems.push(e),e.setParent(null)}},{key:"detachAllItems",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++){var n=this._attachedItems[e];n.detachAllItems(),this.detachItem(n)}this._finalizeRemoved()}},{key:"children",value:function(){for(var e=[],t=0,n=this._attachedItems.length;t<n;t++)e=(e=e.concat(this._attachedItems[t])).concat(this._attachedItems[t].children());return e}},{key:"_resetItems",value:function(){this._attachedItems.length=0}},{key:"_resetRemoved",value:function(){this._removedItems.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedItems.length;e<t;e++){var n=this._removedItems[e],i=this._attachedItems.indexOf(n);-1!=i&&this._attachedItems.splice(i,1)}this._resetRemoved()}},{key:"setImage",value:function(e){this.spriteName=e,this.size=ct.sprites.getSpriteSize(e)}},{key:"getOrigin",value:function(){var e=this.getPosition();return new u(e.x-this.size.x/2,e.y-this.size.y/2)}},{key:"getPosition",value:function(){var e=new u,t=new u,n=new u;return null!==this._parent?(t=this._parent.getPosition(),n=this._parent.rotation.transformPosition(this.position),e.x=n.x+t.x,e.y=n.y+t.y):(e.x=this.position.x,e.y=this.position.y),e}},{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e,t){this.size.x=e,this.size.y=t}},{key:"getScaling",value:function(){return this.scaling}},{key:"setScaling",value:function(e,t){this.scaling.x=e,this.scaling.y=t}},{key:"getSpeed",value:function(){return this.speed}},{key:"setSpeed",value:function(e,t){this.speed.x=e,this.speed.y=t}},{key:"getParentPosition",value:function(){return null!==this._parent?this._parent.getPosition():new u}},{key:"getParentSpeed",value:function(){return null!==this._parent?this._parent.getSpeed():new u}},{key:"getRadius",value:function(){return Math.sqrt(Math.pow(this.size.x/2,2)+Math.pow(this.size.y/2,2))}},{key:"getMagnitude",value:function(){return Math.sqrt(this.speed.x*this.speed.x+this.speed.y*this.speed.y)}},{key:"move",value:function(e,t){this.position.x+=e,this.position.y+=t}},{key:"rotate",value:function(e){this.rotation.rotate(e)}},{key:"setRotation",value:function(e){this.rotation.update(e)}},{key:"getRotation",value:function(){return null!==this._parent?this.rotation.getAngle()+this._parent.getRotation():this.rotation.getAngle()}},{key:"draw",value:function(e){if(!0===this._visible){for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].draw(e);null!==this.spriteName&&ct.sprites.draw(e,this),!0===ct.options.drawBoundingBoxes&&this.drawHelper(e,"spriteBox"),!0===ct.options.drawMaxRadius&&this.drawHelper(e,"maxRadius"),!0===ct.options.drawCollisionRadius&&this.drawHelper(e,"collisionRadius"),!0===ct.options.drawOrigins&&this.drawHelper(e,"origin"),!0===ct.options.drawCenters&&this.drawHelper(e,"center"),!0===ct.options.drawDirectionVectors&&this.drawHelper(e,"direction")}}},{key:"step",value:function(e){0===this.speed.x&&0===this.speed.y||this.move(this.speed.x*e/ct.core.TIME_PER_FRAME,this.speed.y*e/ct.core.TIME_PER_FRAME),0!==this.vRot&&this.rotate(this.vRot*e/ct.core.TIME_PER_FRAME),!0===this.isAnimated&&null!==this.spriteName&&ct.sprites.step(e,this);for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].step(e);this._finalizeRemoved()}},{key:"eventAnimationRestart",value:function(){}},{key:"drawHelper",value:function(e,t){var n=this.getPosition(),i=this.getSize(),r=this.getScaling();if("maxRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.maxRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("collisionRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.collisionRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("origin"==t)e.fillStyle="#FF0000",e.fillRect(n.x-i.x/2*r.x,n.y-i.y/2*r.y,2,2);else if("center"==t)e.fillStyle="#FF0000",e.fillRect(n.x,n.y,2,2);else if("spriteBox"==t)e.lineWidth=1,e.strokeStyle="#FF0000",e.strokeRect(n.x-i.x/2*r.x,n.y-i.y/2*r.y,i.x*r.x,i.y*r.y);else if("direction"==t){var o=this.getSpeed();e.lineWidth=1,e.strokeStyle="#FF0000",e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x+10*o.x,n.y+10*o.y),e.stroke()}}},{key:"collide",value:function(){return this.detachAllItems(),!0}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==z(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==z(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===z(r)?r:String(r)),i)}var r}function F(){return F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=L(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},F.apply(this,arguments)}function L(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function M(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(i);if(r){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return M(this,e)});function s(e,t,n,i,r){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a=o.call(this);var l=ct.sprites.sprites[e];return a.size=new u(l[3],l[4]),a.numFrames=l[5],a.position=new u(t,n),a.speed=new u(i,r),a.lived=0,a.lifeTime=0,a.maxLoops=1,a.spriteName=e,a.initialScaling=1,a.finalScaling=1,a.transparencyMethod=0,a.globalAlpha=1,a}return t=s,(n=[{key:"step",value:function(e){F(D(s.prototype),"step",this).call(this,e),this.lived++;var t=1;1==this.initialScaling&&1==this.finalScaling||(t=this.initialScaling+(this.finalScaling-this.initialScaling)*this.lived/this.lifeTime,this.scaling.x=t,this.scaling.y=t),2==this.transparencyMethod?0!==this.lifeTime?this.globalAlpha=1-this.lived/this.lifeTime:this.globalAlpha=1-this.currentFrame/this.numFrames:1==this.transparencyMethod&&(0!==this.lifeTime?this.globalAlpha=this.lived/this.lifeTime:this.globalAlpha=this.currentFrame/this.numFrames),!0===this.isAnimated&&ct.sprites.step(e,this)}},{key:"draw",value:function(e){F(D(s.prototype),"draw",this).call(this,e)}}])&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(C);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==K(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==K(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===K(r)?r:String(r)),i)}var r}var U=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.effects=[],this.removed=[]}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.effects.length=0}},{key:"removeEffect",value:function(e){this.removed.push(e)}},{key:"_resetRemoved",value:function(){this.removed.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this.removed.length;e<t;e++){var n=this.effects.indexOf(this.removed[e]);-1!=n&&this.effects.splice(n,1)}}},{key:"step",value:function(e){this._resetRemoved();for(var t=0,n=this.effects.length;t<n;t++){var i=this.effects[t];i.step(e),i.lifeTime>0&&i.lived>i.lifeTime&&this.removeEffect(i),i.maxLoops>0&&i.numLoops>i.maxLoops&&this.removeEffect(i)}this._finalizeRemoved()}},{key:"draw",value:function(e){for(var t=0,n=this.effects.length;t<n;t++)this.effects[t].draw(e)}},{key:"addEffect",value:function(e,t,n,i,r){var o=new B(e,t,n,i,r);return this.effects.push(o),o}}])&&G(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==H(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==H(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===H(r)?r:String(r)),i)}var r}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.particles=[],this.maxParticles=1e4,this._removedParticles=[],this.effectField=document.createElement("canvas"),this.effectField.width=ct.core.size.x,this.effectField.height=ct.core.size.y,this.effectField.ctx=this.effectField.getContext("2d")}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.particles=[],this.maxParticles=1e4,this._removedParticles=[]}},{key:"addParticle",value:function(e){this.particles.length>this.maxParticles||this.particles.push(e)}},{key:"removeParticle",value:function(e){this._removedParticles.push(e)}},{key:"_resetItems",value:function(){this.particles.length=0}},{key:"_resetRemoved",value:function(){this._removedParticles.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedParticles.length;e<t;e++){var n=this._removedParticles[e],i=this.particles.indexOf(n);-1!=i&&this.particles.splice(i,1)}}},{key:"step",value:function(e){var t,n,i=this.particles.length;for(t=0;t<i;t++)(n=this.particles[t]).lived>n.ttl?this.removeParticle(n):n.step(e);this._finalizeRemoved()}},{key:"draw",value:function(e){if(this.particles.length>0){this.effectField.ctx.clearRect(0,0,ct.core.size.x,ct.core.size.y);for(var t,n=-1;t=this.particles[++n];){var i=[t.color[0]-3*t.lived,t.color[1]-t.lived,t.color[2],t.color[3]];this.effectField.ctx.fillStyle="rgba("+i.join(",")+")",this.effectField.ctx.fillRect(t.position.x,t.position.y,t.size,t.size)}e.drawImage(this.effectField,0,0,ct.core.size.x,ct.core.size.y)}}}])&&V(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==q(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==q(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===q(r)?r:String(r)),i)}var r}var Q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sprites={},this.images={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.sprites.length=0,this.images.length=0}},{key:"step",value:function(e,t){var n=this.sprites[t.spriteName][7],i=this.sprites[t.spriteName][5],r=this.sprites[t.spriteName][6];if(0!==t.forceFrameSpeed&&(n=t.forceFrameSpeed),i>1){var o=(new Date).getTime();if(0===t.timeLastFrame&&(t.timeLastFrame=o),o-t.timeLastFrame>1e3/n){var s=t.currentFrame;t.currentFrame++,t.currentFrame>=r+i&&(t.currentFrame=r),t.timeLastFrame=o,s==i-1&&(t.numLoops+=1,void 0!==t.eventAnimationRestart&&t.eventAnimationRestart())}}}},{key:"draw",value:function(e,t){if(!1!==t.getVisible()){var n=this.sprites[t.spriteName][0],i=this.sprites[t.spriteName][1],r=this.sprites[t.spriteName][2],o=this.sprites[t.spriteName][3],s=this.sprites[t.spriteName][4],a=t.getPosition();e.globalAlpha=t.globalAlpha,0!==t.rotation.getAngle()?(e.save(),e.translate(a.x,a.y),e.rotate(t.rotation.getAngle()),e.drawImage(this.images[n],i+t.currentFrame*o,r,o,s,-o/2*t.scaling.x,-s/2*t.scaling.y,o*t.scaling.x,s*t.scaling.y),e.restore()):e.drawImage(this.images[n],i+t.currentFrame*o,r,o,s,a.x-o/2*t.scaling.x,a.y-s/2*t.scaling.y,o*t.scaling.x,s*t.scaling.y),e.globalAlpha=1}}},{key:"imageExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.images,e)}},{key:"spriteExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.sprites,e)}},{key:"addImage",value:function(e,t){this.images[e]=t}},{key:"addSprite",value:function(e,t,n,i,r,o,s,a,l){this.sprites[e]=[t,n,i,r,o,s,a,l]}},{key:"getImage",value:function(e){return this.images[this.sprites[e][0]]}},{key:"getImageFromPath",value:function(e){return this.images[e]}},{key:"getSpriteData",value:function(e){var t=this.sprites[e];return void 0!==t?t:null}},{key:"getSpriteInfo",value:function(e,t){var n=this.sprites[e];if(void 0!==n){var i=n[t];if(void 0!==i)return i}return null}},{key:"getSpriteSize",value:function(e){var t=this.sprites[e],n=0,i=0;return void 0!==t&&(n=t[3],i=t[4]),new u(n,i)}}])&&Y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==X(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==X(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===X(r)?r:String(r)),i)}var r}var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sounds={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.sounds.length=0}},{key:"step",value:function(){}},{key:"soundExists",value:function(e){for(var t=Object.keys(this.sounds),n=0,i=t.length;n<i;n++)if(this.sounds[t[n]][1]==e)return!0;return!1}},{key:"addSound",value:function(e,t,n){this.sounds[e]=[n,t]}},{key:"get",value:function(e){if(void 0===this.sounds[e])return null;var t=this.sounds[e][0];return t.currentTime>0&&(t=t.cloneNode()),t}},{key:"play",value:function(e){var t=this.get(e);null!==t&&(t.currentTime>0&&(t.currentTime=0),t.play())}}])&&Z(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function ee(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==$(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==$(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===$(r)?r:String(r)),i)}var r}var te=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fonts={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.fonts.length=0}},{key:"step",value:function(){}},{key:"fontExists",value:function(e){for(var t=Object.keys(this.fonts),n=0,i=t.length;n<i;n++)if(this.fonts[t[n]][1]==e)return!0;return!1}},{key:"addFont",value:function(e,t,n){this.fonts[e]=[n,t]}},{key:"get",value:function(e){return void 0===this.fonts[e]?null:this.fonts[e][0]}}])&&ee(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ne(e){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(e)}function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==ne(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==ne(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===ne(r)?r:String(r)),i)}var r}var re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection=null,this.currentSceneIndex=null,this.currentSceneName=null,this.currentScene=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.collection=[],this.currentSceneIndex=0,this.currentSceneName="",this.currentScene=null}},{key:"activate",value:function(){}},{key:"draw",value:function(){}},{key:"step",value:function(){}},{key:"getCurrentScene",value:function(){return this.currentScene}},{key:"setScene",value:function(e){void 0!==this.currentScene&&null!==this.currentScene&&(this.currentScene.isCurrent=!1),ct.core.clearScreen(),this.currentSceneIndex=e,this.currentSceneName=ct.scenes.collection[e].name,this.currentScene=ct.scenes.collection[e].scene,this.currentScene.isCurrent=!0,this.currentScene.activate(),void 0!==ct.player&&null!==ct.player&&ct.player.activate(),ct.logs.log("Scenes::setScene","Set Scene: "+this.currentSceneName+" ("+this.currentSceneIndex+")"),ct.external("SCENE_CHANGE",null,null)}},{key:"addScene",value:function(e,t){ct.logs.log("Scenes::addScene","Add Scene: "+t),e.isCurrent=!1,this.collection.push({scene:e,name:t})}},{key:"insertScene",value:function(e,t,n){e.isCurrent=!1,this.collection.splice(n,0,{scene:e,name:t})}},{key:"advanceScene",value:function(){ct.scenes.currentSceneIndex+1>=ct.scenes.collection.length||ct.scenes.setScene(ct.scenes.currentSceneIndex+1)}},{key:"goBackScene",value:function(){this.currentSceneIndex-1<0||this.setScene(this.currentSceneIndex-1)}}])&&ie(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==oe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==oe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===oe(r)?r:String(r)),i)}var r}var ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startTime=0,this.passedTime=0,this.ticker500=0,this.listeners500={},this.ticker1=0,this.listeners1={},this.ticker5=0,this.listeners5={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.startTime=(new Date).getTime()}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.ticker1+=e,this.ticker5+=e,this.ticker500+=e,this.ticker1>=1e3&&(this.informListeners(this.listeners1),this.ticker1=0),this.ticker5>=5e3&&(this.informListeners(this.listeners5),this.ticker5=0),this.ticker500>=500&&(this.informListeners(this.listeners500),this.ticker500=0)}},{key:"draw",value:function(){}},{key:"suscribe500",value:function(e,t){this.listeners500[e]=t}},{key:"suscribeOneSecond",value:function(e,t){this.listeners1[e]=t}},{key:"suscribeFiveSeconds",value:function(e,t){this.listeners5[e]=t}},{key:"informListeners",value:function(e){for(var t in e)e[t]()}}])&&se(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==le(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==le(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===le(r)?r:String(r)),i)}var r}var ue=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fallbackLanguage="english",this.selectedLanguage="",this.stringTables={},this.baseTexts={english:{paused:"Paused, press P to continue",loaded:"Loading",items:"items",effects:"effects",particles:"particles",choose_language:"Choose language",english:"English",spanish:"Spanish"},spanish:{paused:"Pausa, pulsa P para continuar",loaded:"Cargando",items:"elementos",effects:"efectos",particles:"partículas",choose_language:"Escoge el idioma",english:"English",spanish:"Español"}}}var t,n;return t=e,(n=[{key:"initialize",value:function(){for(var e in this.selectedLanguage="english",this.baseTexts)this.stringTables[e]=[],this.addTextsToStringTable(e,this.baseTexts[e])}},{key:"get",value:function(e){var t=this.stringTables[this.selectedLanguage][e];return void 0!==t?t:this.stringTables[this.fallbackLanguage][e]}},{key:"addStringTable",value:function(e,t){this.stringTables[e]=t}},{key:"setBaseTexts",value:function(e){this.baseTexts=e}},{key:"addTextsToStringTable",value:function(e,t){for(var n in t)this.stringTables[e][n]=t[n]}},{key:"selectLanguage",value:function(e){this.selectedLanguage=e}}])&&ce(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==fe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==fe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===fe(r)?r:String(r)),i)}var r}function ye(){return ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=pe(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},ye.apply(this,arguments)}function pe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=me(e)););return e}function ve(e,t){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ve(e,t)}function de(e,t){if(t&&("object"===fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function me(e){return me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},me(e)}var be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ve(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=me(i);if(r){var n=me(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return de(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).guiId=null,void 0!==e?t.setParent(e):t.guiId="globalGUI",t.inputCallbacks={},t.guiElements={},t.blink=!1,t}return t=s,(n=[{key:"initialize",value:function(){ye(me(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){ye(me(s.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){ye(me(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){ye(me(s.prototype),"step",this).call(this,e)}},{key:"setBlink",value:function(e){var t=this.getParentScene();null!==t&&(!0===e?(this.blink=!0,t.clock.suscribe(this.guiId+"_clock",this,"blinkStep",350)):(this.blink=!1,this.setVisible(!0),t.clock.unsuscribe(this.guiId+"_clock")))}},{key:"blinkStep",value:function(){!0===this.blink&&!0===this.getVisible()?this.setVisible(!1):(!0===this.blink&&!1===this.getVisible()||!1===this.blink)&&this.setVisible(!0)}},{key:"addInputCallback",value:function(e,t){var n=this.getParentScene();null!==n&&(n.input.addKeyListener(this,"eventKeyPressed",[e],!0),this.inputCallbacks[e]=t)}},{key:"eventKeyPressed",value:function(e){void 0!==this.inputCallbacks[e]&&this.inputCallbacks[e]()}},{key:"getElement",value:function(e){var t=this.guiElements[e];return void 0!==t?t:null}},{key:"get",value:function(e){return this.getElement(e)}},{key:"attachItem",value:function(e,t){this.guiElements[t]=e,e.guiId=t,ye(me(s.prototype),"attachItem",this).call(this,e)}},{key:"detachItem",value:function(e){void 0!==e&&(ye(me(s.prototype),"detachItem",this).call(this,this.get(e)),delete this.guiElements[e])}},{key:"detachAllItems",value:function(){for(var e=Object.keys(this.guiElements),t=0,n=e.length;t<n;t++)this.guiElements[e[t]].detachAllItems(),this.detachItem(e[t]);this.guiElements={},this._finalizeRemoved()}},{key:"_resetItems",value:function(){this.attachedItems.length=0,this.guiElements={}}}])&&he(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(C);function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==ge(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==ge(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===ge(r)?r:String(r)),i)}var r}function we(){return we="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Se(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},we.apply(this,arguments)}function Se(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oe(e)););return e}function ke(e,t){return ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ke(e,t)}function Pe(e,t){if(t&&("object"===ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Oe(e){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Oe(e)}var xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ke(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Oe(i);if(r){var n=Oe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Pe(this,e)});function s(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).text=e,i.font='base,BaseFont,"Courier New"',i.fontSize=20,i.fontColor="#FFFFFF",i.fontBorderColor="#000000",i.textAlign=Ne.LEFT,i.verticalOffset=20,i.horizontalOffset=10,void 0===t||void 0===n?(i.size.x=100,i.size.y=30):(i.size.x=t,i.size.y=n),i._canvasRendering=!0,i._innerCanvas=document.createElement("canvas"),i._innerCanvas.width=i.size.x,i._innerCanvas.height=i.size.y,i._innerContext=i._innerCanvas.getContext("2d"),i._innerChange=!0,i}return t=s,(n=[{key:"initialize",value:function(){we(Oe(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){we(Oe(s.prototype),"activate",this).call(this)}},{key:"setSize",value:function(e,t){we(Oe(s.prototype),"setSize",this).call(this,e,t),this._innerCanvas.width=this.size.x,this._innerCanvas.height=this.size.y,this._innerChange=!0}},{key:"setText",value:function(e){this.text!=e&&(this.text=e,this._innerChange=!0)}},{key:"getText",value:function(){return this.text}},{key:"_updateInnerRender",value:function(e){var t=new u(this.horizontalOffset,this.verticalOffset);this.textAlign==Ne.CENTER?t.x=this.size.x/2:this.textAlign==Ne.RIGHT&&(t.x=this.size.x-this.horizontalOffset),this._innerContext.lineWidth=e.lineWidth,this._innerContext.clearRect(0,0,this.size.x,this.size.y),this._innerContext.strokeStyle=this.fontBorderColor,this._innerContext.fillStyle=this.fontColor,this._innerContext.textAlign=this.textAlign,this._innerContext.font="bold "+this.fontSize+"px "+this.font;for(var n=this.getText().split("\n"),i=0,r=n.length;i<r;i++)this._innerContext.strokeText(n[i],t.x,t.y),this._innerContext.fillText(n[i],t.x,t.y),t.y+=this.verticalOffset;this._innerChange=!1}},{key:"draw",value:function(e){if(!0===this.getVisible()){var t=this.getPosition(),n=this.getSize();if(!1===this._canvasRendering){var i=new u(this.horizontalOffset,this.verticalOffset);this.textAlign==Ne.CENTER?i.x=this.size.x/2:this.textAlign==Ne.RIGHT&&(i.x=this.size.x-this.horizontalOffset),e.strokeStyle=this.fontBorderColor,e.fillStyle=this.fontColor,e.textAlign=this.textAlign,e.font="bold "+this.fontSize+"px "+this.font;for(var r=this.getText().split("\n"),o=0,a=r.length;o<a;o++)e.strokeText(r[o],t.x-n.x/2+i.x,t.y-n.y/2+i.y),e.fillText(r[o],t.x-n.x/2+i.x,t.y-n.y/2+i.y),i.y+=this.verticalOffset}else!0===this._innerChange&&this._updateInnerRender(e),e.drawImage(this._innerCanvas,t.x-this.size.x/2,t.y-this.size.y/2)}we(Oe(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){we(Oe(s.prototype),"step",this).call(this,e)}},{key:"setFont",value:function(e){this.font=e}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"setFontColor",value:function(e){this.fontColor=e}},{key:"setFontBorderColor",value:function(e){this.fontBorderColor=e}},{key:"setAlign",value:function(e){this.textAlign=e}},{key:"setCanvasRendering",value:function(e){this._canvasRendering=e}},{key:"setVerticalOffset",value:function(e){this.verticalOffset=e}},{key:"setHorizontalOffset",value:function(e){this.horizontalOffset=e}}])&&Ae(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(be);function Ee(e){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ee(e)}function Te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==Ee(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==Ee(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===Ee(r)?r:String(r)),i)}var r}function _e(){return _e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Re(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},_e.apply(this,arguments)}function Re(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ze(e)););return e}function je(e,t){return je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},je(e,t)}function Ce(e,t){if(t&&("object"===Ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ze(e){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(e)}var Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&je(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ze(i);if(r){var n=ze(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ce(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this))._texts={},e._textKeys=[],e._textsToRemove=[],e.order=Fe.DOWN,e}return t=s,(n=[{key:"initialize",value:function(){_e(ze(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){_e(ze(s.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){_e(ze(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){var t=this._textKeys.length;if(0!==t){for(var n=0,i=(new Date).getTime(),r=0;r<t;r++){var o=this._texts[this._textKeys[r]],a=o[1];o[2]+2e3<i?this._textsToRemove.push(this._textKeys[r]):(a.setPosition(0,n),this.order==Fe.DOWN?n+=20:n-=20)}if(_e(ze(s.prototype),"step",this).call(this,e),(t=this._textsToRemove.length)>0){for(var l=0;l<t;l++)this.detachItem(this._textsToRemove[l]),delete this._texts[this._textsToRemove[l]];this._textKeys=Object.keys(this._texts),this._textsToRemove=[]}}}},{key:"addText",value:function(e,t){if(void 0!==this._texts[e])this._texts[e][0]!=t&&(this._texts[e][0]=t,this._texts[e][1].setText(t)),this._texts[e][2]=(new Date).getTime();else{var n=new xe(t,this.size.x,this.size.y);n.setSize(this.size.x,this.size.y),this._texts[e]=[t,n,(new Date).getTime()],this._textKeys=Object.keys(this._texts),this.attachItem(n,e)}}}])&&Te(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(be),Fe={UP:0,DOWN:1},Le={SELECTION:0},Ne={LEFT:"left",RIGHT:"right",CENTER:"center"};function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==Me(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==Me(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===Me(r)?r:String(r)),i)}var r}function Be(){return Be="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Ke(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Be.apply(this,arguments)}function Ke(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ve(e)););return e}function Ge(e,t){return Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ge(e,t)}function Ue(e,t){if(t&&("object"===Me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return He(e)}function He(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ve(e)}var We=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ge(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ve(i);if(r){var n=Ve(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ue(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).playable=!1,e.backgrounds=[],e.isCurrent=!1,e.gui=new be(He(e)),e.clock=new ae,e.input=new b,e}return t=s,(n=[{key:"initialize",value:function(){var e=this;Be(Ve(s.prototype),"initialize",this).call(this);var t=new Ie;t.setSize(170,30),t.setPosition(15+t.size.x/2,15+t.size.y/2),t.order=Fe.DOWN,this.gui.initialize(),this.gui.attachItem(t,"console"),this.clock.initialize(),ct.clock.suscribeOneSecond("FPS",(function(){ct.options.showFps&&e.gui.get("console").addText("fps",ct.core.fpsPassed+" fps"),ct.core.fpsPassed=0})),this.input.initialize()}},{key:"activate",value:function(){Be(Ve(s.prototype),"activate",this).call(this),this.gui.activate(),this.clock.activate(),this.input.activate();for(var e=0,t=this.backgrounds.length;e<t;e++)this.backgrounds[e].activate()}},{key:"draw",value:function(e){e.clearRect(0,0,ct.core.size.x,ct.core.size.y);for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].draw(e);Be(Ve(s.prototype),"draw",this).call(this,e),this.gui.draw(e)}},{key:"step",value:function(e){for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].step(e);this.clock.step(e),Be(Ve(s.prototype),"step",this).call(this,e),this.gui.step(e)}},{key:"addBackground",value:function(e){this.backgrounds.push(e)}},{key:"pauseGame",value:function(){if(null===this.gui.get("pause")){var e=new xe(ct.localization.get("paused"),500,30);e.setFontColor("#FF2222"),e.setAlign(Ne.CENTER),e.setPosition(ct.core.size.x/2,ct.core.size.y/2+100),this.gui.attachItem(e,"pause")}}},{key:"unpauseGame",value:function(){this.gui.detachItem("pause")}}])&&De(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(C);function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";function Ye(){this.fontFamily="fjs"+(999999*Math.random()|0)}!function(e){try{return void new Uint8Array(1)}catch(e){}function t(e,t){return this.slice(e,t)}function n(e,t){var n,i=e.length;for(arguments.length<2&&(t=0),n=0;n<i;++n,++t)this[t]=255&e[n]}function i(e){var i,r;if("number"==typeof e)for(i=new Array(e),r=0;r<e;++r)i[r]=0;else i=e.slice(0);return i.subarray=t,i.buffer=i,i.byteLength=i.length,i.set=n,"object"===qe(e)&&e.buffer&&(i.buffer=e.buffer),i}e.Uint8Array=i,e.Uint32Array=i,e.Int32Array=i}(window),function(e){var t;e.opera||"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||(t=e.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t}))}(window),window.btoa||(window.btoa=function(e){var t,n,i,r,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",u=[];if(!e)return e;do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,i=o>>6&63,r=63&o,u[l++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(r)}while(a<e.length);c=u.join("");var f=e.length%3;return(f?c.slice(0,f-3):c)+"===".slice(f||3)}),Ye.prototype.url="",Ye.prototype.format="",Ye.prototype.data="",Ye.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",Ye.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},Ye.prototype.systemfont=!1,Ye.prototype.loaded=!1,Ye.prototype.onload=function(){},Ye.prototype.onerror=function(){},Ye.prototype.canvas=!1,Ye.prototype.context=!1,Ye.prototype.validate=function(e,t,n,i,r){!1!==r&&r<0?this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed)."):getComputedStyle(e,null).getPropertyValue("width").replace("px","")>0?(document.head.removeChild(t),document.body.removeChild(e),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout((function(){i.validate(e,t,n,i,!1!==r&&r-50)}),1e3))},Ye.prototype.ondownloaded=function(){var e=this,t=function(e){return String.fromCharCode(e)},n=function(e){if(e<256)return t(0)+t(e);var n=255&e;return t(e>>8)+t(n)},i=function(e,t){return 256*e+t},r=function(e,t){var n,i=e>>7==1;return n=256*(e&=127)+t,i?n-32768:n},o=function(e,t,n,i){return 16777216*e+65536*t+256*n+i},s=function(t){e.onerror(t)},a=t(0)+t(1)+t(0)+t(0),l=this.data,c=t(l[0])+t(l[1])+t(l[2])+t(l[3]),u=c===a,f=!u&&"OTTO"===c;if(u)this.format="truetype";else{if(!f)return void s("Error: file at "+this.url+" cannot be interpreted as OpenType font.");this.format="opentype"}var h,y,p=i(l[4],l[5]),v=12+16*p,d={};for(h=12;h<v;h+=16)y=t(l[h])+t(l[h+1])+t(l[h+2])+t(l[h+3]),d[y]={name:y,checksum:o(l[h+4],l[h+5],l[h+6],l[h+7]),offset:o(l[h+8],l[h+9],l[h+10],l[h+11]),length:o(l[h+12],l[h+13],l[h+14],l[h+15])};var m=function(e){return d[e]?e:(s("Error: font is missing the required OpenType '"+e+"' table."),!1)};if(!1!==(y=m("head"))){h=d[y].offset,d[y].version=""+l[h]+l[h+1]+l[h+2]+l[h+3];var b=i(l[h+18],l[h+19]);if(this.metrics.quadsize=b,!1!==(y=m("hhea"))&&(h=d[y].offset,d[y].version=""+l[h]+l[h+1]+l[h+2]+l[h+3],this.metrics.ascent=r(l[h+4],l[h+5])/b,this.metrics.descent=r(l[h+6],l[h+7])/b,this.metrics.leading=r(l[h+8],l[h+9])/b,!1!==(y=m("OS/2"))&&(h=d[y].offset,d[y].version=""+l[h]+l[h+1],this.metrics.weightclass=i(l[h+4],l[h+5]),!1!==(y=m("cmap"))))){h=d[y].offset,d[y].version=""+l[h]+l[h+1],p=i(l[h+2],l[h+3]);for(var g,A,w,S,k=!1,P=0;P<p;P++)A=i(l[g=h+4+8*P],l[g+1]),w=i(l[g+2],l[g+3]),S=o(l[g+4],l[g+5],l[g+6],l[g+7]),3===A&&1===w&&(k=S);var O="A";if(!1!==k&&4===(c=i(l[h+=k],l[h+1]))){for(var x=function(e){return-1===[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(e)},E=h+14,T=h+14+i(l[h+6],l[h+7])/2*2,_=!1;E<T&&!x(_=i(l[E],l[E+1]));E+=2)_=!1;if(0!=_){O=String.fromCharCode(_);var R=(65536-(_-1))%65536,j=t(0)+n(_)+n(65535)+n(0)+n(_)+n(65535)+n(R)+n(1),C=btoa(j);this.base64=this.base64.substring(0,380)+C+this.base64.substring(380+C.length)}}this.bootstrapValidation(O,!1)}}},Ye.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont",i=document.createElement("style");i.setAttribute("type","text/css"),i.innerHTML="@font-face {\n  font-family: '"+n+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}",document.head.appendChild(i);var r=!1;this.systemfont||(r=this.toStyleNode(),document.head.appendChild(r));var o=document.createElement("p");if(o.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",o.style.fontFamily="'"+this.fontFamily+"', '"+n+"'",o.innerHTML=e+e+e+e+e+e+e+e+e+e,document.body.appendChild(o),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var s=this.systemfont?1e3:this.metrics.quadsize,a=document.createElement("canvas");a.width=s,a.height=s,this.canvas=a;var l=a.getContext("2d");l.font="1em '"+this.fontFamily+"'",l.fillStyle="white",l.fillRect(-1,-1,s+2,s+2),l.fillStyle="black",l.fillText("test text",50,s/2),this.context=l;var c=this;setTimeout((function(){c.validate(o,i,r,c,t)}),50)}},Ye.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},Ye.prototype.loadFont=function(){var e=this;if(-1!==this.url.indexOf(".")){var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(n){var i=t.response;i?(e.data=new Uint8Array(i),e.ondownloaded()):e.onerror("Error downloading font resource from "+e.url)},t.onerror=function(t){e.onerror("Error downloading font resource from "+e.url)},t.send(null)}else setTimeout((function(){e.processSystemFont()}),10)},Ye.prototype.styleNode=!1,Ye.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css",this.url.replace(".ttf",".eot");var e="@font-face {\n";return e+="  font-family: '"+this.fontFamily+"';\n",e+="  src: url('"+this.url+"') format('"+this.format+"');\n",e+="}",this.styleNode.innerHTML=e,this.styleNode},Ye.prototype.measureText=function(e,t){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t,n.ascent=0,n.descent=0,n.bounds={minx:0,maxx:n.width,miny:0,maxy:0},n.height=0;var i=[];n.width,this.metrics.quadsize,i.push(e);var r,o=i.length;for(r=0;r<o;r++)this.measureSegment(i[r],t,n);return n},Ye.prototype.measureSegment=function(e,t,n){var i=document.createElement("div");for(i.style.position="absolute",i.style.opacity=0,i.style.font=t+"px '"+this.fontFamily+"'",i.innerHTML=e,m=1;m<10;m++)i.innerHTML+="<br/>"+e;document.body.appendChild(i),n.leading=1.2*t;var r,o=(r=i,"height",document.defaultView.getComputedStyle(r,null).getPropertyValue("height"));if((o=o.replace("px",""))>=10*t&&(n.leading=o/10|0),document.body.removeChild(i),/^\s*$/.test(e))return n;this.canvas;var s=this.context,a=this.systemfont?1e3:this.metrics.quadsize,l=a,c=a,u=a/2,f=(a-n.width)/2;f!==(0|f)&&(f|=0),s.fillStyle="white",s.fillRect(-50,-50,l+100,c+100),s.fillStyle="black",s.fillText(e,f,u);for(var h=n.width+50|0,y=4*t,p=f-25,v=u-y/2,d=s.getImageData(p,v,h,y).data,m=0,b=0,g=4*h,A=d.length,w=y/2;++m<A&&255===d[m];);var S=m/g|0;for(m=A-1;--m>0&&255===d[m];);var k=m/g|0;for(m=0,b=0;b<h&&255===d[m];)(m+=g)>=A&&(b++,m=m-A+4);var P=b,O=1;for(m=A-3,b=0;b<h&&255===d[m];)(m-=g)<0&&(b++,m=A-3-4*O++);var x=h-b;return n.ascent=w-S,n.descent=k-w,n.bounds={minx:P-25,maxx:x-25,miny:-n.descent,maxy:n.ascent},n.height=k-S+1,n},Object.defineProperty(Ye.prototype,"src",{set:function(e){this.url=e,this.loadFont()}}),"undefined"!=typeof define?define((function(){return Ye})):window.Font=Ye;const Qe=Ye;function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==Xe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==Xe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===Xe(r)?r:String(r)),i)}var r}function Je(){return Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=$e(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Je.apply(this,arguments)}function $e(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nt(e)););return e}function et(e,t){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e,t){if(t&&("object"===Xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function nt(e){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nt(e)}var it=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&et(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=nt(i);if(r){var n=nt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return tt(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).timeStarted=0,e.percentageLoaded=0,e.incremental=0,e.imageAssets=[],e.totalImages=0,e.soundAssets=[],e.totalFonts=0,e.message=null,e}return t=s,(n=[{key:"initialize",value:function(){Je(nt(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){var e,t,n;for(ct.logs.log("Preloader::activate","Loading assets"),Je(nt(s.prototype),"activate",this).call(this),this.timeStarted=(new Date).getTime(),e=0,t=this.imageAssets.length;e<t;e++)n=this.imageAssets[e],this.addImageToLoad(n);for(e=0,t=this.soundAssets.length;e<t;e++)n=this.soundAssets[e],this.addSoundToLoad(n);this.message=new xe(ct.localization.get("loaded")+" "+this.percentageLoaded+"%",300,30),this.message.setPosition(ct.core.size.x/2,ct.core.size.y/2+100),this.message.setAlign(Ne.CENTER),this.message.setVerticalOffset(20),this.message.setFontColor("#FF2222"),this.gui.attachItem(this.message,"msg_loading")}},{key:"addAnimation",value:function(e){this.imageAssets.push(e)}},{key:"addSprite",value:function(e){e.xStart=0,e.yStart=0,e.frames=1,e.initFrame=0,e.speed=0,this.addAnimation(e)}},{key:"addImageToLoad",value:function(e){var t=null;ct.sprites.imageExists(e.path)||(f("load",t=new Image,(function(){ct.preloader.incrementalLoader()})),null!==ct.options.assetsURLPrefix?t.src=ct.options.assetsURLPrefix+e.path:t.src=h()+e.path,this.totalImages++,ct.sprites.addImage(e.path,t)),ct.sprites.spriteExists(e.name)||ct.sprites.addSprite(e.name,e.path,e.xStart,e.yStart,e.width,e.height,e.frames,e.initFrame,e.speed)}},{key:"addSound",value:function(e){this.soundAssets.push(e)}},{key:"addSoundToLoad",value:function(e){var t=null;if(!ct.sounds.soundExists(e.path)){var n=e.path;n=null!==ct.options.assetsURLPrefix?ct.options.assetsURLPrefix+n:h()+n,(t=new Audio(n)).load(),f("canplaythrough",t,(function(){ct.preloader.incrementalLoader("sound")})),ct.sounds.addSound(e.name,e.path,t)}}},{key:"addFont",value:function(e){var t=new Qe;this.totalFonts++,t.onerror=function(e){ct.logs.log("Preloader::addFont","Error loading a font: "+e)},t.onload=function(){ct.logs.log("Preloader::addFont","Font loaded <"+t.fontFamily+">"),ct.preloader.incrementalLoader("font")},t.fontFamily=e.name,void 0!==e.flag?t.src=e.path:null!==ct.options.assetsURLPrefix?t.src=ct.options.assetsURLPrefix+e.path:t.src=h()+e.path,ct.fonts.addFont(e.name,e.path,t)}},{key:"incrementalLoader",value:function(){var e=this.totalImages+this.soundAssets.length+this.totalFonts;this.incremental+=1,this.percentageLoaded=Math.floor(100*this.incremental/e)}},{key:"draw",value:function(e){Je(nt(s.prototype),"draw",this).call(this,e);var t=ct.core.size.x/3;e.fillStyle="#FF2222",e.fillRect((ct.core.size.x-t)/2+1,ct.core.size.y/2+51,this.percentageLoaded*t/100,15),e.lineWidth=2,e.strokeStyle="#FFEEEE",e.strokeRect((ct.core.size.x-t)/2,ct.core.size.y/2+50,t+2,16)}},{key:"step",value:function(e){Je(nt(s.prototype),"step",this).call(this,e),this.message.setText(ct.localization.get("loaded")+" "+this.percentageLoaded+"%");var t=(new Date).getTime()-this.timeStarted;this.percentageLoaded>=100&&t>1e3&&(ct.core.activate(),ct.external("LOADED",null,null))}}])&&Ze(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(We);function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==rt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==rt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===rt(r)?r:String(r)),i)}var r}var st=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ct.logs.log("Player::initialize","Initializing player object"),this.avatar=null}var t,n;return t=e,(n=[{key:"getAvatar",value:function(){return this.avatar}},{key:"setAvatar",value:function(e){this.avatar=e}},{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(){}},{key:"draw",value:function(){}}])&&ot(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function at(e){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(e)}function lt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==at(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==at(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===at(r)?r:String(r)),i)}var r}const ct=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=null,this.logs=null,this.core=null,this.device=null,this.effects=null,this.particles=null,this.sprites=null,this.sounds=null,this.fonts=null,this.clock=null,this.localization=null,this.input=null,this.controls=null,this.scenes=null,this.preloader=null,this.game=null,this.externalCallback=null,this.player=null}var t,n;return t=e,(n=[{key:"initialize",value:function(e,t,n){this.options=new a,this.logs=new ht,this.core=new k,this.device=new x,this.effects=new U,this.particles=new W,this.sprites=new Q,this.sounds=new J,this.fonts=new te,this.clock=new ae,this.localization=new ue,this.input=new v,this.scenes=new re,this.preloader=new it,this.player=new st,this.logs.log("Engine::initialize","Initializing starts..."),this.game=t,void 0!==n&&(this.externalCallback=n),this.core.initialize(e),this.device.initialize(),this.effects.initialize(),this.particles.initialize(),this.sprites.initialize(),this.sounds.initialize(),this.clock.initialize(),this.input.initialize(),this.localization.initialize(),this.scenes.initialize(),this.preloader.playable=!1,this.preloader.initialize(),this.game.initialize()}},{key:"external",value:function(e,t,n){var i=this;"undefined"!=typeof externalCallback&&setTimeout((function(){try{i.externalCallback(e,t,n)}catch(n){i.logs.log("Engine::external","Error with external callback with event "+e+" "+t)}}),1)}}])&&lt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}());function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function ft(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==ut(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==ut(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===ut(r)?r:String(r)),i)}var r}var ht=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"log",value:function(e,t,n){var i=[];if(!1!==ct.options.debugInConsole)if(!0===ct.options.debugFunctionNames&&i.push(e),Array.isArray(t)?i.push(t.join(" ")):i.push(t),n&&i.push(n),!0===ct.options.debugInHtml&&void 0!==ct.core.canvas){var r=document.createElement("div");r.innerHTML=i,ct.core.canvas.parentNode.appendChild(r)}else void 0===window.console||void 0===window.console.log||window.console.log(i)}}])&&ft(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function yt(e,t){return void 0===t.x||void 0===t.y||void 0===e.x||void 0===e.y?-1:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function pt(e){var t=new u;return t.x=Math.cos(e),t.y=Math.sin(e),t}function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function dt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==vt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==vt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===vt(r)?r:String(r)),i)}var r}function mt(e,t){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mt(e,t)}function bt(e,t){if(t&&("object"===vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function gt(e){return gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gt(e)}var At=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mt(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=gt(i);if(r){var n=gt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return bt(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this)).setPosition(e.x,e.y),n.setSpeed(t.x,t.y),n.ttl=-1,n.lived=0,n.color=[],n.size=2,n}return t=s,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.move(this.speed.x*e/ct.core.TIME_PER_FRAME,this.speed.y*e/ct.core.TIME_PER_FRAME),this.lived++}},{key:"draw",value:function(){}},{key:"collide",value:function(){return!1}}])&&dt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(C);function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function St(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==wt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==wt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===wt(r)?r:String(r)),i)}var r}function kt(){return kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Pt(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},kt.apply(this,arguments)}function Pt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Et(e)););return e}function Ot(e,t){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ot(e,t)}function xt(e,t){if(t&&("object"===wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Et(e){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Et(e)}var Tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ot(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Et(i);if(r){var n=Et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return xt(this,e)});function s(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).size=new u(10,10),i.particleSpeed=e,i.magnitude=t,i.particleColor=[255,255,255,255],i.particleLife=100,i.particleSize=3,i.started=!1,i.spread=n,i.emissionRate=3,i}return t=s,(n=[{key:"start",value:function(){this.started=!0}},{key:"stop",value:function(){this.started=!1}},{key:"createParticle",value:function(){var e=Math.random()*this.spread-this.spread/2,t=pt(this.getRotation()+e);t=t.normalize();var n=new u(t.x*this.particleSpeed,t.y*this.particleSpeed),i=this.getPosition(),r=new At(i,n);r.ttl=Math.random()*this.particleLife,r.color=this.particleColor,r.size=this.particleSize,ct.particles.addParticle(r)}},{key:"step",value:function(e){if(kt(Et(s.prototype),"step",this).call(this,e),!0===this.started)for(var t=0;t<this.emissionRate;t++)this.createParticle()}},{key:"draw",value:function(e){kt(Et(s.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(){return!1}}])&&St(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(C);function _t(e){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_t(e)}function Rt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==_t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==_t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key,"string"),"symbol"===_t(r)?r:String(r)),i)}var r}function jt(){return jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Ct(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},jt.apply(this,arguments)}function Ct(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ft(e)););return e}function zt(e,t){return zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zt(e,t)}function It(e,t){if(t&&("object"===_t(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ft(e){return Ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ft(e)}var Lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zt(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ft(i);if(r){var n=Ft(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return It(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).backgroundType="image",e.color="black",e.spriteName=null,e.position.x=ct.core.size.x/2,e.position.y=ct.core.size.y/2,e.pauseScroll=!1,e.verticalScroll=!1,e.verticalOffset=0,e.verticalSpeed=0,e.horizontalScroll=!1,e.horizontalOffset=0,e.horizontalSpeed=0,e}return t=s,(n=[{key:"initialize",value:function(){jt(Ft(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){jt(Ft(s.prototype),"activate",this).call(this),this.verticalOffset=0,this.horizontalOffset=0}},{key:"step",value:function(e){jt(Ft(s.prototype),"step",this).call(this,e),!1===this.pauseScroll&&(!0===this.verticalScroll?(this.verticalOffset+=this.verticalSpeed*e/ct.core.TIME_PER_FRAME,this.verticalOffset=Math.floor(this.verticalOffset%ct.core.size.y)):!0===this.horizontalScroll&&(this.horizontalOffset+=this.horizontalSpeed*e/ct.core.TIME_PER_FRAME,this.horizontalOffset=Math.floor(this.horizontalOffset%ct.core.size.x)))}},{key:"draw",value:function(e){if("color"==this.backgroundType)e.fillStyle=this.color,e.fillRect(0,0,ct.core.size.x,ct.core.size.y);else if("image"==this.backgroundType){var t,n;!0===this.verticalScroll?(t=Math.floor(this.verticalOffset),n=ct.core.size.y-t,t>0&&e.drawImage(ct.sprites.getImage(this.spriteName),0,n,ct.core.size.x,t,0,0,ct.core.size.x,t),n>0&&e.drawImage(ct.sprites.getImage(this.spriteName),0,0,ct.core.size.x,n,0,t,ct.core.size.x,n)):!0===this.horizontalScroll?(t=Math.floor(this.horizontalOffset),n=ct.core.size.x-t,t>0&&e.drawImage(ct.sprites.getImage(this.spriteName),0,0,t,ct.core.size.y,n,0,t,ct.core.size.y),n>0&&e.drawImage(ct.sprites.getImage(this.spriteName),t,0,n,ct.core.size.y,0,0,n,ct.core.size.y)):ct.sprites.draw(e,this)}}}])&&Rt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(C);function Nt(e,t,n){return"complete"===document.readyState?ct.initialize(e,t,n):f("load",window,(function(){ct.initialize(e,t,n)})),ct}return t})()));